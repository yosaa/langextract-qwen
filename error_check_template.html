<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£çº é”™æ£€æŸ¥ç»“æœ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            background: #f5f7fa;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }
        
        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px;
            overflow-y: auto;
        }
        
        .original-text {
            flex: 2;
            position: relative;
        }
        
        .error-results {
            flex: 1;
        }
        
        h2 {
            color: #303133;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #F56C6C;
            font-size: 20px;
        }
        
        .text-content {
            line-height: 2;
            color: #606266;
            font-size: 16px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* ä¸åŒç±»å‹é”™è¯¯çš„é«˜äº®æ ·å¼ */
        .highlight {
            cursor: pointer;
            transition: all 0.3s;
            padding: 2px 4px;
            border-radius: 3px;
            position: relative;
        }
        
        .error-typo {
            background-color: #FFE6E6;
            border-bottom: 2px solid #F56C6C;
        }
        
        .error-grammar {
            background-color: #FFF7E6;
            border-bottom: 2px solid #E6A23C;
        }
        
        .error-punctuation {
            background-color: #E6F7FF;
            border-bottom: 2px solid #409EFF;
        }
        
        .error-other {
            background-color: #F4F4F5;
            border-bottom: 2px solid #909399;
        }
        
        .highlight:hover {
            filter: brightness(0.9);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .highlight.active {
            background-color: #FFD666 !important;
            border-bottom: 2px solid #FAAD14 !important;
            box-shadow: 0 0 10px rgba(250, 173, 20, 0.4);
            animation: pulse 1s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .error-item {
            background: #fafafa;
            border-left: 4px solid #909399;
            padding: 14px 16px;
            margin-bottom: 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .error-item.type-typo {
            border-left-color: #F56C6C;
        }
        
        .error-item.type-grammar {
            border-left-color: #E6A23C;
        }
        
        .error-item.type-punctuation {
            border-left-color: #409EFF;
        }
        
        .error-item:hover {
            background: #f0f0f0;
            transform: translateX(4px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .error-item.active {
            background: #FFF7E6;
            box-shadow: 0 4px 12px rgba(250, 173, 20, 0.3);
        }
        
        .error-type {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .error-type .icon {
            font-size: 18px;
        }
        
        .type-typo .error-type {
            color: #F56C6C;
        }
        
        .type-grammar .error-type {
            color: #E6A23C;
        }
        
        .type-punctuation .error-type {
            color: #409EFF;
        }
        
        .error-detail {
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 8px;
        }
        
        .error-original {
            color: #F56C6C;
            font-size: 15px;
            margin-bottom: 6px;
            text-decoration: line-through;
        }
        
        .error-correct {
            color: #67C23A;
            font-size: 15px;
            font-weight: 500;
        }
        
        .error-position {
            color: #909399;
            font-size: 12px;
            margin-top: 6px;
        }
        
        .error-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-left: 8px;
        }
        
        .status-matched {
            background: #e7f9f0;
            color: #52c41a;
        }
        
        .status-unmatched {
            background: #fff7e6;
            color: #faad14;
        }
        
        /* å¼•å¯¼çº¿æ ·å¼ */
        #guide-line {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }
        
        #guide-line svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        
        .guide-path {
            fill: none;
            stroke: #FAAD14;
            stroke-width: 3;
            stroke-dasharray: 8, 4;
            animation: dash 20s linear infinite;
        }
        
        @keyframes dash {
            to {
                stroke-dashoffset: -100;
            }
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #ffd4d4;
        }
        
        .stats-title {
            font-size: 14px;
            color: #606266;
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat-item {
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #909399;
        }
        
        .stat-typo .stat-number {
            color: #F56C6C;
        }
        
        .stat-grammar .stat-number {
            color: #E6A23C;
        }
        
        .stat-punctuation .stat-number {
            color: #409EFF;
        }
        
        .stat-total .stat-number {
            color: #67C23A;
        }
        
        /* å›¾ä¾‹ */
        .legend {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 12px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #303133;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        
        .legend-color {
            width: 30px;
            height: 16px;
            border-radius: 2px;
        }
        
        .arrow-label {
            color: #909399;
            margin: 0 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel original-text">
            <h2>ğŸ“„ åŸå§‹æ–‡æ¡£</h2>
            <div class="text-content" id="original-text">
                <!-- åŸæ–‡å†…å®¹å°†åœ¨è¿™é‡Œæ’å…¥ -->
            </div>
        </div>
        
        <div class="panel error-results">
            <h2>ğŸ” çº é”™ç»“æœ</h2>
            
            <div class="stats" id="stats">
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            </div>
            
            <div class="legend">
                <div class="legend-title">é”™è¯¯ç±»å‹å›¾ä¾‹</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFE6E6; border-bottom: 2px solid #F56C6C;"></div>
                    <span>é”™åˆ«å­—</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFF7E6; border-bottom: 2px solid #E6A23C;"></div>
                    <span>è¯­ç—…</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #E6F7FF; border-bottom: 2px solid #409EFF;"></div>
                    <span>æ ‡ç‚¹ç¬¦å·é”™è¯¯</span>
                </div>
            </div>
            
            <div id="errors-container">
                <!-- é”™è¯¯ç»“æœå°†åœ¨è¿™é‡Œæ’å…¥ -->
            </div>
        </div>
    </div>
    
    <div id="guide-line"></div>
    
    <script>
        // æ•°æ®å°†åœ¨è¿™é‡Œæ³¨å…¥
        const errorsData = {{ERRORS_DATA}};
        const originalTextData = {{ORIGINAL_TEXT_DATA}};
        
        // æ¸²æŸ“åŸæ–‡
        document.getElementById('original-text').innerHTML = originalTextData;
        
        // ç»Ÿè®¡å„ç±»é”™è¯¯æ•°é‡
        const stats = {
            typo: 0,
            grammar: 0,
            punctuation: 0,
            total: 0,
            matched: 0
        };
        
        errorsData.forEach(err => {
            stats.total++;
            if (err.matched) stats.matched++;
            
            if (err.type === 'é”™åˆ«å­—') stats.typo++;
            else if (err.type === 'è¯­ç—…') stats.grammar++;
            else if (err.type === 'æ ‡ç‚¹ç¬¦å·é”™è¯¯') stats.punctuation++;
        });
        
        // æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯
        document.getElementById('stats').innerHTML = `
            <div class="stats-title">æ£€æµ‹åˆ° <strong>${stats.total}</strong> ä¸ªé”™è¯¯ï¼Œå·²å®šä½ <strong>${stats.matched}</strong> ä¸ª</div>
            <div class="stats-grid">
                <div class="stat-item stat-typo">
                    <div class="stat-number">${stats.typo}</div>
                    <div class="stat-label">é”™åˆ«å­—</div>
                </div>
                <div class="stat-item stat-grammar">
                    <div class="stat-number">${stats.grammar}</div>
                    <div class="stat-label">è¯­ç—…</div>
                </div>
                <div class="stat-item stat-punctuation">
                    <div class="stat-number">${stats.punctuation}</div>
                    <div class="stat-label">æ ‡ç‚¹ç¬¦å·é”™è¯¯</div>
                </div>
                <div class="stat-item stat-total">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">æ€»è®¡</div>
                </div>
            </div>
        `;
        
        // å›¾æ ‡æ˜ å°„
        const iconMap = {
            'é”™åˆ«å­—': 'âŒ',
            'è¯­ç—…': 'âš ï¸',
            'æ ‡ç‚¹ç¬¦å·é”™è¯¯': 'ğŸ“'
        };
        
        // ç±»å‹æ ·å¼æ˜ å°„
        const typeClassMap = {
            'é”™åˆ«å­—': 'type-typo',
            'è¯­ç—…': 'type-grammar',
            'æ ‡ç‚¹ç¬¦å·é”™è¯¯': 'type-punctuation'
        };
        
        // æ¸²æŸ“é”™è¯¯ç»“æœ
        const errorsContainer = document.getElementById('errors-container');
        errorsData.forEach((err, index) => {
            const item = document.createElement('div');
            const typeClass = typeClassMap[err.type] || 'type-other';
            item.className = `error-item ${typeClass}`;
            item.dataset.id = index;
            
            const icon = iconMap[err.type] || 'â€¢';
            const posInfo = err.start >= 0 ? `ä½ç½®: ${err.start}-${err.end}` : 'æœªå®šä½';
            const statusHtml = err.matched 
                ? '<span class="error-status status-matched">âœ“ å·²å®šä½</span>'
                : '<span class="error-status status-unmatched">âš  æœªå®šä½</span>';
            
            item.innerHTML = `
                <div class="error-type">
                    <span class="icon">${icon}</span>
                    <span>${err.type}</span>
                    ${statusHtml}
                </div>
                <div class="error-detail">
                    <div class="error-original">âœ— ${err.original || err.full_text}</div>
                    ${err.correct ? `<div class="error-correct">âœ“ ${err.correct}</div>` : ''}
                    <div class="error-position">${posInfo}</div>
                </div>
            `;
            
            // åªæœ‰å·²å®šä½çš„æ‰èƒ½ç‚¹å‡»é«˜äº®
            if (err.matched) {
                item.addEventListener('click', () => highlightError(index));
            } else {
                item.style.cursor = 'default';
                item.style.opacity = '0.7';
            }
            errorsContainer.appendChild(item);
        });
        
        // é«˜äº®é”™è¯¯å‡½æ•°
        function highlightError(id) {
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.highlight').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.error-item').forEach(el => el.classList.remove('active'));
            
            // æ·»åŠ æ–°é«˜äº®
            const highlight = document.querySelector(`.highlight[data-id="${id}"]`);
            const errorItem = document.querySelector(`.error-item[data-id="${id}"]`);
            
            if (highlight) {
                highlight.classList.add('active');
                highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            if (errorItem) {
                errorItem.classList.add('active');
            }
            
            // ç»˜åˆ¶å¼•å¯¼çº¿
            if (highlight && errorItem) {
                drawGuideLine(highlight, errorItem);
            }
        }
        
        // ç»˜åˆ¶å¼•å¯¼çº¿
        function drawGuideLine(fromElement, toElement) {
            const guideLine = document.getElementById('guide-line');
            guideLine.innerHTML = '';
            
            const fromRect = fromElement.getBoundingClientRect();
            const toRect = toElement.getBoundingClientRect();
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.width = '100%';
            svg.style.height = '100%';
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            
            const x1 = fromRect.right;
            const y1 = fromRect.top + fromRect.height / 2;
            const x2 = toRect.left;
            const y2 = toRect.top + toRect.height / 2;
            
            const midX = (x1 + x2) / 2;
            
            const d = `M ${x1} ${y1} C ${midX} ${y1}, ${midX} ${y2}, ${x2} ${y2}`;
            path.setAttribute('d', d);
            path.setAttribute('class', 'guide-path');
            
            svg.appendChild(path);
            guideLine.appendChild(svg);
            
            // 3ç§’åæ¸…é™¤å¼•å¯¼çº¿
            setTimeout(() => {
                guideLine.innerHTML = '';
            }, 3000);
        }
        
        // åŸæ–‡é«˜äº®åŒºåŸŸç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.highlight').forEach(el => {
            el.addEventListener('click', function() {
                const id = this.dataset.id;
                highlightError(id);
            });
        });
    </script>
</body>
</html>
